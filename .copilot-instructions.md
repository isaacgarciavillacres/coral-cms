# Copilot Instructions for Coral CMS

> **Note**: The primary Copilot instructions are now located in `.github/copilot-instructions.md` with proper `applyTo` syntax for file-specific guidance. This file serves as additional context.

## Project Overview

This is a **marketing website for a construction company** built with **Next.js 15**, **Payload CMS 3.59.1**, and **shadcn/ui** components. It uses TypeScript, Tailwind CSS, and Vercel Postgres as the database.

## Design Theme

- **Industry**: Construction Company Marketing Website
- **Light Mode**: Red primary color (#ef4444) for construction branding
- **Dark Mode**: Generic black tones with subtle white accents
- **Color Scheme**: Professional construction industry aesthetic

## Tech Stack

- **Framework**: Next.js 15.4.4 with App Router
- **CMS**: Payload CMS 3.59.1
- **Database**: Vercel Postgres
- **UI Library**: shadcn/ui with Radix UI primitives
- **Styling**: Tailwind CSS 3.4.3 with CSS variables
- **Language**: TypeScript 5.7.3
- **Package Manager**: pnpm
- **Node Version**: ^18.20.2 || >=20.9.0

## Project Structure

### Core Directories

- `src/app/(frontend)/` - Next.js frontend pages and layouts
- `src/app/(payload)/` - Payload CMS admin interface
- `src/collections/` - Payload CMS collections (Pages, Posts, Media, Users, Categories)
- `src/components/` - Reusable React components and shadcn/ui components
- `src/blocks/` - Payload CMS blocks for flexible content
- `src/fields/` - Custom Payload CMS fields
- `src/utilities/` - Utility functions and helpers

### Key Files

- `src/payload.config.ts` - Payload CMS configuration
- `components.json` - shadcn/ui configuration
- `tailwind.config.mjs` - Tailwind CSS configuration
- `next.config.js` - Next.js configuration

## Development Guidelines

### Payload CMS

**Core Principles:**

- Use Payload 3.x syntax and patterns
- Collections are in `src/collections/`
- Custom fields in `src/fields/`
- Blocks for flexible content in `src/blocks/`
- Use Lexical rich text editor (`@payloadcms/richtext-lexical`)
- Database adapter: `@payloadcms/db-vercel-postgres`

**Collection Development:**

- Always define proper TypeScript interfaces for collections
- Use proper field configurations with validation
- Include `populatePublishedAt` hook for content with publish dates
- Implement proper access control (see `src/access/`)
- Add slug fields for URL-friendly identifiers
- Configure meta fields for SEO (title, description, image)

**Content Architecture:**

- **Pages Collection**: For static pages with flexible layouts using blocks
- **Posts Collection**: For blog posts and news articles with categories and authors
- **Media Collection**: For file uploads with proper alt text and captions
- **Categories Collection**: For organizing posts and content
- **Users Collection**: For authentication with roles (admin, editor)

**Block System:**

- Create reusable content blocks in `src/blocks/`
- Each block should have: Component.tsx, config.ts, and types
- Use proper TypeScript interfaces for block data
- Include server-side validation
- Example blocks: Banner, Content, CallToAction, MediaBlock, Form

**Field Patterns:**

- Use `src/fields/link.ts` for consistent link handling
- Use `src/fields/linkGroup.ts` for navigation menus
- Use `src/fields/defaultLexical.ts` for rich text with consistent features
- Always include proper validation and required field indicators

**Rich Text Configuration:**

- Use Lexical editor with custom features (headings, links, lists, etc.)
- Configure proper serialization for frontend rendering
- Include upload functionality for inline images
- Use consistent text styling and formatting options

### shadcn/ui Components

- Components are installed in `src/components/ui/`
- Use the configured aliases: `@/components` and `@/utilities/ui`
- Base color: slate
- CSS variables are enabled
- No prefix configured
- Components use Radix UI primitives
- Tailwind CSS integration with `tailwind-merge` and `clsx`

### Styling

- Use Tailwind CSS utility classes
- **Light Mode**: Red primary color (`bg-primary`, `text-primary`) for construction branding
- **Dark Mode**: Generic black tones (`bg-background`, `text-foreground`)
- CSS variables are enabled for theming with `[data-theme="dark"]` selector
- Additional construction-themed colors available:
  - `construction-red-*` (50-900 scale)
  - `construction-orange-*` (400, 500, 600)
  - `construction-yellow-*` (400, 500)
  - `construction-gray-*` (selected grays)
- Typography plugin enabled for content
- Animation utilities from `tailwindcss-animate`
- Global styles in `src/app/(frontend)/globals.css`

## Payload CMS Development Guidelines

**Always refer to PAYLOAD-INSTRUCTIONS.md for comprehensive Payload CMS guidance.**

### Content Management Best Practices

**For Company Employees (Content Creators):**

- Access admin panel at `/admin`
- Use the visual page builder with blocks for flexible layouts
- Always fill out SEO meta fields (title, description, image)
- Upload images with proper alt text for accessibility
- Use categories to organize blog posts and content
- Preview content before publishing
- Use rich text editor for formatted content with headings, lists, and links

**For Developers:**

- Build reusable content blocks for non-technical users
- Implement proper validation and error handling
- Create intuitive admin interfaces with clear labels
- Use TypeScript interfaces for type safety
- Follow established patterns in existing collections
- Test admin interface usability with content creators
- Ensure responsive design for admin components

### Development Workflow

1. **New Feature Development:**
   - Create collections and fields in Payload for content structure
   - Build frontend components that consume Payload data
   - Use blocks system for flexible, reusable content sections
   - Implement proper loading states and error handling
   - Generate types with `pnpm generate:types` after schema changes

2. **Content Structure:**
   - Design collections that match business requirements
   - Create blocks that non-technical users can easily manage
   - Implement proper relationships between collections
   - Use globals for site-wide settings (header, footer, SEO defaults)

3. **Frontend Integration:**
   - Fetch data using Payload's local API
   - Use Server Components for initial page loads
   - Implement proper error boundaries
   - Cache data appropriately for performance

### Template Usage for Company

This CMS template is designed for:

- Marketing websites with dynamic content management
- Blog/news functionality with categories and authors
- Flexible page layouts using the block system
- SEO optimization with meta field management
- Media management with proper organization
- User role management for content creators and administrators

**Deployment Considerations:**

- Configure environment variables for database and admin access
- Set up proper authentication for production
- Configure image optimization and CDN integration
- Implement proper backup strategies for content
- Monitor performance and optimize queries

## Commands

- `pnpm dev` - Start development server
- `pnpm build` - Build for production
- `pnpm start` - Start production server
- `pnpm generate:types` - Generate Payload types
- `pnpm lint` - Run ESLint
- `pnpm test` - Run all tests (integration + e2e)

## Important Notes

- Always use `@/` imports for project files
- Follow Payload 3.x patterns for collections and fields
- Use shadcn/ui components when building UI
- Maintain TypeScript strict mode
- Use CSS variables for theming
- Follow Next.js App Router conventions
- Use Server Components by default, mark Client Components with 'use client'

## File Naming Conventions

- Components: PascalCase (e.g., `MyComponent.tsx`)
- Pages: lowercase with hyphens (e.g., `my-page/page.tsx`)
- Utilities: camelCase (e.g., `myUtility.ts`)
- Payload collections: PascalCase (e.g., `Posts.ts`)

## Database

- Uses Vercel Postgres adapter
- Payload handles schema management
- Types are auto-generated with `pnpm generate:types`

## Testing

- E2E tests with Playwright
- Integration tests with Vitest
- Test files in `tests/` directory

When working on this project:

1. **ALWAYS reference PAYLOAD-INSTRUCTIONS.md for comprehensive Payload CMS guidance**
2. Use the established patterns and conventions
3. Leverage shadcn/ui components for UI elements
4. Follow Payload CMS 3.x best practices
5. Use TypeScript throughout
6. **Maintain construction industry branding with red accent colors in light mode**
7. **Use generic black tones for dark mode**
8. Use Server Components when possible
9. Generate types after schema changes with `pnpm generate:types`
10. Consider construction industry UX patterns (professional, trustworthy, clear CTAs)
11. Use appropriate construction-themed colors from the extended palette
12. Build CMS features that non-technical users can easily manage
13. Test admin interface usability and provide clear documentation
14. Implement proper validation and error handling for CMS operations
15. Use the block system for flexible, reusable content sections
